# Autogenerated Images Integration Strategy

## Overview

This document outlines the strategy for automatically embedding autogenerated screenshots from openadapt-viewer into the openadapt-web landing page. The goal is to showcase real viewer functionality with live, up-to-date screenshots that are automatically regenerated when viewers are updated.

## Current State Analysis

### Screenshot Generation System (openadapt-viewer)

**Location**: `/Users/abrichr/oa/src/openadapt-viewer/scripts/`

**Key Scripts**:
- `generate_comprehensive_screenshots.py` - Generates screenshots for all viewers
- `generate_segmentation_screenshots.py` - Specialized segmentation viewer screenshots

**Current Capabilities**:
- Automated screenshot generation using Playwright
- Multiple viewer types: capture, segmentation, synthetic, benchmark
- Multiple scenarios per viewer (overview, details, search, filters, etc.)
- Responsive viewports (desktop 1920x1080, tablet 768x1024, mobile 375x667)
- Configurable output directory (default: `docs/images/`)
- Metadata generation (JSON with screenshot details)

**Example Output** (from `/Users/abrichr/oa/src/openadapt-viewer/docs/images/`):
```
turn-off-nightshift_full.png (159 KB)
turn-off-nightshift_controls.png (107 KB)
turn-off-nightshift_events.png (79 KB)
demo_new_full.png (103 KB)
demo_new_controls.png (63 KB)
demo_new_events.png (44 KB)
```

### Current Landing Page Image Usage (openadapt-web)

**Location**: `/Users/abrichr/oa/src/openadapt-web/`

**Components Using Images**:

1. **MastHead.js** (`/pages/index.js`)
   - Uses `demo.mp4` video (85 MB) with dynamic poster generation
   - No static screenshots currently displayed
   - Video demonstrates OpenAdapt in action

2. **IndustriesGrid.js**
   - Uses static SVG icons from `/public/images/`
   - Industry icons: noun-human-resources.svg, noun-law.svg, etc.
   - No viewer screenshots currently used

3. **Developers.js**
   - No images, focuses on installation and download stats
   - Could benefit from viewer screenshots

**Current Image Storage**: `/Users/abrichr/oa/src/openadapt-web/public/images/`
- Only contains static SVG icons and favicons
- No autogenerated screenshots

**Deployment**:
- Hosted on Vercel (connected to GitHub repo)
- Next.js static site generation
- Images served from `/public/images/` directory

## Design Options

### Option 1: Direct Commit to Repo (MVP - Recommended)

**Architecture**:
```
openadapt-viewer/scripts/
    → generate screenshots
    → commit to openadapt-web/public/images/screenshots/
    → push to GitHub
    → Vercel auto-deploys
```

**Pros**:
- Simple, no external dependencies
- Works with existing Vercel deployment
- Images are versioned in git
- Fast page loads (images served from CDN)
- Easy to preview and review changes via PR

**Cons**:
- Increases repo size (mitigated by using optimized PNGs)
- Manual or CI-triggered regeneration
- Not suitable for large-scale community gallery

**Implementation**:
1. Generate screenshots in openadapt-viewer
2. Copy to openadapt-web/public/images/screenshots/
3. Commit and push (via PR, never directly to main)
4. Vercel auto-deploys on merge to main

### Option 2: GitHub Actions + Artifact Storage

**Architecture**:
```
GitHub Actions (openadapt-viewer)
    → generate screenshots on schedule/trigger
    → upload to GitHub Release artifacts
    → openadapt-web fetches from GitHub API at build time
```

**Pros**:
- Automated regeneration on schedule
- Doesn't bloat main repo
- Versioned releases

**Cons**:
- More complex setup
- Slower page loads (external API calls)
- API rate limits
- Requires build-time data fetching

### Option 3: External Storage (S3/CDN)

**Architecture**:
```
CI/CD → generate screenshots → upload to S3 → CloudFront CDN → openadapt-web
```

**Pros**:
- Scalable for large image collections
- Fast CDN delivery
- No repo bloat
- Can handle community gallery

**Cons**:
- Requires AWS account and costs
- More complex infrastructure
- Not necessary for MVP

### Option 4: Next.js API Routes + Dynamic Generation

**Architecture**:
```
openadapt-web API route
    → calls openadapt-viewer endpoint
    → returns screenshot
    → cached at edge
```

**Pros**:
- Always up-to-date
- No storage needed

**Cons**:
- Requires server-side rendering
- Complex implementation
- Playwright in production is challenging
- Not suitable for Vercel free tier

## Recommended Strategy: Phased Approach

### Phase 1: MVP (Direct Commit) - Implement Immediately

**Goal**: Get autogenerated screenshots on landing page with minimal complexity.

**Implementation**:

1. **Create Screenshot Directory Structure**
   ```
   openadapt-web/public/images/screenshots/
   ├── capture/
   │   ├── turn-off-nightshift_full.png
   │   ├── turn-off-nightshift_controls.png
   │   └── demo_new_full.png
   ├── segmentation/
   │   ├── 01_initial_empty.png
   │   ├── 02_episodes_loaded.png
   │   └── 03_episode_thumbnails.png
   ├── benchmark/
   │   ├── summary.png
   │   └── task_detail.png
   └── README.md  # Metadata about generation
   ```

2. **Generate Script in openadapt-viewer**
   ```bash
   # Location: /Users/abrichr/oa/src/openadapt-viewer/scripts/generate_for_web.sh
   #!/bin/bash

   # Generate all screenshots
   cd /Users/abrichr/oa/src/openadapt-viewer

   # Capture viewer screenshots
   uv run python scripts/generate_comprehensive_screenshots.py \
       --viewers capture \
       --output /tmp/oa-screenshots/capture

   # Segmentation viewer screenshots (desktop only for speed)
   uv run python scripts/generate_segmentation_screenshots.py \
       --skip-responsive \
       --output /tmp/oa-screenshots/segmentation

   # Copy to openadapt-web
   WEB_DIR=/Users/abrichr/oa/src/openadapt-web/public/images/screenshots
   mkdir -p $WEB_DIR
   cp -r /tmp/oa-screenshots/* $WEB_DIR/

   # Generate metadata
   echo "Generated at: $(date -u +"%Y-%m-%dT%H:%M:%SZ")" > $WEB_DIR/README.md
   echo "From: openadapt-viewer" >> $WEB_DIR/README.md
   ```

3. **Update Landing Page Components**

   **New Component**: `components/ViewerShowcase.js`
   ```jsx
   import Image from 'next/image'
   import styles from './ViewerShowcase.module.css'

   export default function ViewerShowcase() {
       const showcaseItems = [
           {
               title: "Capture Viewer",
               description: "Record and playback human demonstrations with detailed event tracking",
               image: "/images/screenshots/capture/turn-off-nightshift_full.png",
               alt: "OpenAdapt Capture Viewer showing turn-off-nightshift recording"
           },
           {
               title: "Segmentation Viewer",
               description: "Browse episodes and key frames from segmented recordings",
               image: "/images/screenshots/segmentation/02_episodes_loaded.png",
               alt: "OpenAdapt Segmentation Viewer with episode library"
           },
           {
               title: "Benchmark Viewer",
               description: "View benchmark results and task-by-task performance",
               image: "/images/screenshots/benchmark/summary.png",
               alt: "OpenAdapt Benchmark Viewer with performance metrics"
           }
       ]

       return (
           <div className={styles.showcase}>
               <h2 className="text-3xl font-light text-center mb-8">
                   Powerful Visualization Tools
               </h2>
               <p className="text-center mb-12 max-w-3xl mx-auto">
                   OpenAdapt includes professional visualization tools for analyzing
                   recordings, browsing episodes, and evaluating model performance.
               </p>
               <div className={styles.grid}>
                   {showcaseItems.map((item, index) => (
                       <div key={index} className={styles.card}>
                           <div className={styles.imageWrapper}>
                               <Image
                                   src={item.image}
                                   alt={item.alt}
                                   width={800}
                                   height={600}
                                   className={styles.screenshot}
                                   quality={90}
                               />
                           </div>
                           <h3 className={styles.title}>{item.title}</h3>
                           <p className={styles.description}>{item.description}</p>
                       </div>
                   ))}
               </div>
           </div>
       )
   }
   ```

   **Add to pages/index.js**:
   ```jsx
   import ViewerShowcase from '@components/ViewerShowcase'

   export default function Home() {
       return (
           <div>
               <MastHead />
               <ViewerShowcase />  {/* NEW */}
               <Developers />
               <IndustriesGrid ... />
               <EmailForm />
               <Footer />
           </div>
       )
   }
   ```

4. **CI/CD Workflow** (Optional for automation)

   **Create**: `.github/workflows/update-screenshots.yml` (in openadapt-viewer repo)
   ```yaml
   name: Update Landing Page Screenshots

   on:
     workflow_dispatch:  # Manual trigger
     schedule:
       - cron: '0 0 * * 0'  # Weekly on Sunday
     push:
       paths:
         - 'segmentation_viewer.html'
         - 'benchmark_viewer.html'
         - 'scripts/generate_*.py'

   jobs:
     generate-screenshots:
       runs-on: ubuntu-latest
       steps:
         - name: Checkout openadapt-viewer
           uses: actions/checkout@v4
           with:
             repository: OpenAdaptAI/openadapt-viewer
             path: openadapt-viewer

         - name: Checkout openadapt-web
           uses: actions/checkout@v4
           with:
             repository: OpenAdaptAI/openadapt-web
             path: openadapt-web
             token: ${{ secrets.WEB_REPO_TOKEN }}

         - name: Set up Python
           uses: actions/setup-python@v5
           with:
             python-version: '3.12'

         - name: Install dependencies
           run: |
             cd openadapt-viewer
             pip install uv
             uv sync
             uv pip install playwright
             uv run playwright install chromium --with-deps

         - name: Generate screenshots
           run: |
             cd openadapt-viewer
             mkdir -p /tmp/oa-screenshots

             # Capture viewer
             uv run python scripts/generate_comprehensive_screenshots.py \
               --viewers capture \
               --output /tmp/oa-screenshots/capture

             # Segmentation viewer
             uv run python scripts/generate_segmentation_screenshots.py \
               --skip-responsive \
               --output /tmp/oa-screenshots/segmentation

         - name: Copy to openadapt-web
           run: |
             WEB_DIR=openadapt-web/public/images/screenshots
             mkdir -p $WEB_DIR
             cp -r /tmp/oa-screenshots/* $WEB_DIR/

             # Generate metadata
             echo "Generated: $(date -u +"%Y-%m-%dT%H:%M:%SZ")" > $WEB_DIR/README.md
             echo "Workflow: ${{ github.run_id }}" >> $WEB_DIR/README.md

         - name: Create Pull Request
           uses: peter-evans/create-pull-request@v5
           with:
             path: openadapt-web
             token: ${{ secrets.WEB_REPO_TOKEN }}
             commit-message: "Update autogenerated screenshots from openadapt-viewer"
             branch: autoupdate-screenshots
             title: "Update autogenerated screenshots"
             body: |
               Automated update of landing page screenshots.

               Generated from openadapt-viewer commit: ${{ github.sha }}
               Workflow run: ${{ github.run_id }}

               Please review the screenshots before merging.
   ```

5. **Manual Process** (Until CI/CD is set up)
   ```bash
   # In openadapt-viewer
   cd /Users/abrichr/oa/src/openadapt-viewer
   ./scripts/generate_for_web.sh

   # In openadapt-web
   cd /Users/abrichr/oa/src/openadapt-web
   git checkout -b update-screenshots-$(date +%Y%m%d)
   git add public/images/screenshots/
   git commit -m "Update autogenerated screenshots from openadapt-viewer"
   git push -u origin update-screenshots-$(date +%Y%m%d)
   gh pr create --title "Update autogenerated screenshots" --body "Updated screenshots from openadapt-viewer"
   ```

### Phase 2: Enhanced Showcase (After MVP)

**Goal**: Create an interactive showcase with multiple screenshots per viewer.

**Features**:
- Image carousel/slider for each viewer
- Lightbox for full-screen viewing
- Filtering by viewer type
- Captions explaining each screenshot
- Links to live viewer demos

**Implementation**:
```jsx
// components/ViewerCarousel.js
import { useState } from 'react'
import Image from 'next/image'

export default function ViewerCarousel({ screenshots }) {
    const [currentIndex, setCurrentIndex] = useState(0)

    return (
        <div className="carousel">
            <Image src={screenshots[currentIndex].path} ... />
            <p>{screenshots[currentIndex].description}</p>
            <div className="controls">
                {screenshots.map((_, i) => (
                    <button onClick={() => setCurrentIndex(i)}>
                        {i + 1}
                    </button>
                ))}
            </div>
        </div>
    )
}
```

### Phase 3: Community Gallery (Long-term Vision)

**Goal**: Allow users to contribute their own recordings and showcase them on the website.

**Architecture**:
```
User recordings
  → openadapt-capture
  → segment in openadapt-ml
  → generate viewer HTML
  → extract screenshots
  → upload to gallery
  → moderation queue
  → publish to website
```

**Storage Solution**: S3 + CloudFront CDN
- User uploads to S3 bucket
- Lambda function generates screenshots
- Moderation dashboard for admin review
- Published to gallery after approval

**Database**:
- PostgreSQL or Firebase for metadata
- Track: user, recording name, timestamp, tags, views
- Search and filter capabilities

**Privacy**:
- Automatic PII/PHI scrubbing using openadapt-privacy
- User consent required before upload
- Option to make recordings private/public

**Implementation**: Separate project, out of scope for MVP

## File Size Optimization

**Current Screenshot Sizes**: 44-159 KB per PNG

**Optimization Strategies**:

1. **PNG Optimization**
   ```bash
   # Using optipng
   optipng -o7 screenshot.png

   # Using pngquant (lossy but good quality)
   pngquant --quality=80-95 screenshot.png
   ```

2. **Next.js Image Optimization**
   - Automatic optimization on build
   - WebP conversion for supported browsers
   - Responsive image sizes
   - Lazy loading

3. **Desktop-Only Screenshots for MVP**
   - Skip responsive screenshots initially
   - Reduces file count by ~70% (13 → 4 screenshots per viewer)

4. **Selective Screenshots**
   - Choose 1-2 most impressive screenshots per viewer
   - Total: ~10-15 images for MVP
   - Estimated repo size increase: 1-2 MB

## Testing Strategy

### Before Merge

1. **Screenshot Generation**
   ```bash
   cd /Users/abrichr/oa/src/openadapt-viewer
   uv run pytest tests/test_segmentation_screenshots.py -v
   uv run python scripts/generate_comprehensive_screenshots.py --check-deps
   ```

2. **Local Next.js Build**
   ```bash
   cd /Users/abrichr/oa/src/openadapt-web
   npm run build
   npm run dev
   # Verify screenshots load correctly
   ```

3. **Image Optimization Check**
   ```bash
   ls -lh public/images/screenshots/**/*.png
   # Ensure no images > 200 KB
   ```

4. **Vercel Preview Deployment**
   - Create PR with screenshots
   - Check Vercel preview link
   - Verify images load correctly
   - Check page load performance

### Automated Tests

```javascript
// cypress/e2e/landing-page.cy.js
describe('Landing Page Screenshots', () => {
    it('should load viewer showcase section', () => {
        cy.visit('/')
        cy.get('.viewer-showcase').should('be.visible')
    })

    it('should load all showcase images', () => {
        cy.visit('/')
        cy.get('.viewer-showcase img').each(($img) => {
            cy.wrap($img)
                .should('be.visible')
                .and('have.prop', 'naturalWidth')
                .should('be.greaterThan', 0)
        })
    })
})
```

## Maintenance Plan

### Weekly (Automated)
- GitHub Action runs screenshot generation
- Creates PR with updated screenshots
- Developer reviews and merges PR

### On Viewer Updates (Manual)
- Developer updates viewer HTML/functionality
- Runs `generate_for_web.sh` locally
- Creates PR with new screenshots
- Deploys after review

### Monthly Review
- Check screenshot file sizes
- Optimize if needed
- Review which screenshots are most effective
- Update showcase selection

## Success Metrics

### MVP Success Criteria
- [ ] Screenshot generation script working
- [ ] Screenshots committed to openadapt-web repo
- [ ] ViewerShowcase component displaying screenshots
- [ ] Vercel deployment successful with images
- [ ] Page load time < 3 seconds
- [ ] No broken images

### Phase 2 Success Criteria
- [ ] Image carousel working smoothly
- [ ] Lightbox implementation
- [ ] Multiple screenshots per viewer
- [ ] User engagement metrics (time on page, clicks)

### Long-term Success Criteria
- [ ] Community gallery live
- [ ] 100+ user-submitted recordings
- [ ] Moderation workflow established
- [ ] Search and filter functionality

## Implementation Timeline

### Week 1: MVP Setup
- Day 1-2: Create screenshot directory structure
- Day 3-4: Implement ViewerShowcase component
- Day 5: Generate and commit initial screenshots
- Day 6-7: Testing and deployment

### Week 2: Automation
- Day 1-3: Set up GitHub Actions workflow
- Day 4-5: Test automated PR creation
- Day 6-7: Documentation and training

### Month 2-3: Enhanced Showcase
- Implement carousel component
- Add lightbox functionality
- Create screenshot metadata system
- User testing and refinement

### Month 4-6: Community Gallery
- Design gallery architecture
- Implement upload system
- Create moderation dashboard
- Beta testing with select users

## Risk Mitigation

### Risk: Repo Size Growth
**Mitigation**:
- Optimize all images before commit
- Use desktop-only screenshots
- Monitor repo size monthly
- Consider LFS if needed

### Risk: Stale Screenshots
**Mitigation**:
- Automated weekly regeneration
- Date stamp in screenshot metadata
- Alerts if generation fails

### Risk: Breaking Changes in Viewers
**Mitigation**:
- Test screenshot generation in CI
- Version screenshots by viewer version
- Fallback to previous screenshots on failure

### Risk: Slow Page Loads
**Mitigation**:
- Next.js image optimization
- Lazy loading below fold
- CDN for image delivery (Vercel)
- Monitor Core Web Vitals

## Open Questions

1. **Which screenshots are most compelling?**
   - Recommendation: Full viewer screenshots showing complete functionality
   - A/B test different screenshots

2. **How often should we regenerate?**
   - Recommendation: Weekly automated + on-demand for releases

3. **Should we show mobile screenshots on landing page?**
   - Recommendation: Desktop only for MVP, mobile in Phase 2

4. **Do we need video demos in addition to screenshots?**
   - Recommendation: Keep existing demo.mp4, add screenshots as supplement

5. **Should screenshots be interactive (click to open live viewer)?**
   - Recommendation: Phase 2 feature, link to hosted viewer demos

## Related Documentation

- [openadapt-viewer/docs/SCREENSHOT_GENERATION.md](../openadapt-viewer/docs/SCREENSHOT_GENERATION.md)
- [openadapt-viewer/CLAUDE.md](../openadapt-viewer/CLAUDE.md)
- [openadapt-web/CLAUDE.md](./CLAUDE.md)

## Next Steps

1. **Immediate (Today)**:
   - Review and approve this design document
   - Create `generate_for_web.sh` script
   - Generate initial screenshots

2. **This Week**:
   - Implement ViewerShowcase component
   - Create PR with screenshots
   - Deploy to Vercel preview
   - Review and merge

3. **Next Sprint**:
   - Set up GitHub Actions workflow
   - Test automated PR creation
   - Document process for team

4. **Future Consideration**:
   - Enhanced showcase with carousel
   - Community gallery architecture
   - Integration with docs.openadapt.ai
